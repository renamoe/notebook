

## CF908D. New Year and Arbitrary Arrangement

[link](https://codeforces.com/problemset/problem/908/D)

初始想法是 DP 状态记录 $\texttt{ab}$ 对儿数和 $\texttt{a}$ 数量，记为 $f(i,j)$，但是可能存在 $\texttt{ab}$ 对儿数 $<k$ 但是末尾有大量 $\texttt{a}$ 的状态，这样复杂度是爆炸的。

观察性质，状态 $f(i,j)$ 如果 $i<k$ 但是 $i+j\ge k$，那么再放一个 $\texttt{b}$ 就会满足。那么只要算下一次出现 $\texttt{b}$ 的期望步数，此时 $f(i,j)=i+j+\frac{1}{P_b}-1$。

写记忆化搜索会很方便。

[submission(0)](https://codeforces.com/contest/908/submission/130460112)

## LOJ#2673. 「NOI2012」迷失游乐园

[link](https://loj.ac/p/2673)

先想树的做法。对于一条路径一定是从终点往起点 DP，而在树上的一条路径可以分成上行和下行两部分，设为 $f,g$，转移：

$$
f(u)=\frac{1}{d(u)}\sum_{v\in \mathrm{son(u)}} (f(v)+w(u,v))
$$


$$
g(u)=\frac{1}{d(u)}(w(u,\mathrm{fa})+\frac{d(\mathrm{fa})\cdot(g(\mathrm{fa})+f(\mathrm{fa}))-f(u)-w(u,\mathrm{fa})}{d(\mathrm{fa})-1})
$$

对于基环树，路径至多会经过环一段连续部分，环很小，直接暴力枚举起终点，可以算出环上每个点向环上走的答案，也就是 $g$。那么先 DP 树上的 $f$，再处理环上的 $g$，再 DP 树上的 $g$ 即可。

[submission(3)](https://loj.ac/s/1267776)

