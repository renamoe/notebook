to do:

[网络流/二分图相关笔记(应用篇)](https://www.luogu.com.cn/blog/command-block/wang-lao-liu-xiang-guan-bi-ji)

-  [P4510 [CTSC2015]性别改造计划 ](https://www.luogu.com.cn/problem/P4510)

---

## UOJ#171. 【WC2016】挑战NPC

[link](https://uoj.ac/problem/171)

一个精妙的构造。

每个筐拆成三个点代表三个空位；每个球向所有能到达的空位连边；让每个筐的三个空位两两连边；求最大匹配。

这样一个“半空”的筐会多产生一个匹配，答案就是最大匹配数减去 $n$。

因为有奇环所以是一般图最大匹配。

注意为了输出方案，每个球一定要匹配上，所以带花树一开始要优先从球开始匹配。

[submission(1)](https://uoj.ac/submission/520156)

## LOJ#2674. 「NOI2012」美食节

[link](https://loj.ac/p/2674)

将时间前缀和的代价拆为每道菜的贡献，即一个厨师 $i$ 倒数第 $k$ 道菜是 $j$，那么代价为 $k\times t_{i,j}$。

那么可以将厨师拆点代表能够做的每一道菜，就是带权匹配的问题了。

点数 $\mathcal O(n+mp)$，边数 $\mathcal O(nmp)$，直接跑费用流过不去。

发现有用的点、边很少，每个厨师用到的拆点也是一个前缀。考虑动态开点，Dinic 每增广一次，将所有用满的厨师新建一个点。点数 $\mathcal O(n+m+p)$，边数 $\mathcal O(n(m+p))$。

[submission(1)](https://loj.ac/s/1321761)

## LOJ#2134. 「NOI2015」小园丁与老司机

[link](https://loj.ac/p/2134)

第一部分是个较为显然的 DP，但是比较难码。上方的点用桶维护；左右点，由于题目限制，对于同一行的点可以暴力枚举入点和出点。

然后将 DP 过程倒着 bfs 所有最优的前驱点可以把第三部分所需的图建出来。

几个坑点：

- 司机朝一个方向到达第一个未到达的树，意味着已到达过的树是可以跨过的；
- 向上走的 DP 值的和左右走的 DP 值分开记；
- 起点是 $(0,0)$，要手动加一个；

然后就是巨大多细节码农题。

第三部分就是有源汇有下界最小流，但是直接上正常的做法会 TLE 一个点。

> 建出附加 $\mathrm{SS},\mathrm{TT}$ 保持流量平衡的图，不连接 $(T,S,+\infty)$，跑 $\mathrm{SS}$ 到 $\mathrm{TT}$ 的最大流，尽量填充循环流。连接 $(T,S,+\infty)$，残量网络上跑 $\mathrm{SS}$ 到 $\mathrm{TT}$ 的最大流，流经 $T$ 到 $S$ 的边的流量就是可行的最小流。

因为本题一定有解，$\mathrm{SS}$ 到 $\mathrm{TT}$ 最后一定满流，为 $\sum_i[d(i)>0]d(i)$，那么它减去第一遍的流量即可。

[submission(**11**)](https://loj.ac/s/1322347)

