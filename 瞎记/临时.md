## 10.16

### T1

无聊。

### T2

经典题上犯傻。

设 $f_u$ 表示 $u\to \mathrm{fa}$ 的期望步数，$g_u$ 表示 $\mathrm{fa}\to u$ 的期望步数。

$$
\begin{aligned}
f_u&=\frac{1}{\mathrm{deg}_u}\left(1+\sum_{v\in \mathrm{ch}_u}\left(1+f_v+f_u\right)\right)\\
g_u&=\frac{1}{\mathrm{deg}_{\mathrm{fa}}}\left(1+\left(1+g_\mathrm{fa}\right)+\sum_{\substack{v\in \mathrm{ch}_{\mathrm{fa}}\\v\neq u}}\left(1+f_v\right)\right)
\end{aligned}
$$

化简一下，

$$
\begin{aligned}
f_u&=\mathrm{deg}_u+\sum_{v\in \mathrm{ch}_u}f_v\\
g_u&=\mathrm{deg}_{\mathrm{fa}}+g_{\mathrm{fa}}+\sum_{\substack{v\in \mathrm{ch}_{\mathrm{fa}}\\v\neq u}}f_v
\end{aligned}
$$

预处理一下，每次询问在 $\mathrm{LCA}$ 两侧路径求和。

### T3

无聊。

### T4

还是 ODT，挺难写的。
