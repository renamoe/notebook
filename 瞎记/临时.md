# 10.13

### T1

暴力做，写个 ST 表就可以 $\mathcal O(n\log n)$。

### T2

每个数的所有可能的方案对应其 DAG 上的一条到终止状态的路径，考虑把所有数的路径进行多重集排列。

多重集排列大概是

$$
\frac{(\sum_{i}r_i)!}{\prod_i r_i!}
$$

我们只关心路径长度 $r_i$，那么我们首先再值域上做一个 DP，求出 $f_{i,j}$ 表示 $i$ 开始到终止状态路径长度为 $j$ 的路径方案数。因为路径长度理论是 $\mathcal O(\log a_i)$ 的，实际上至多为 $4$，所以可以直接做。

然后在序列上对 $\sum_i r_i$ DP $\dfrac{1}{\prod_i r_i!}$ 之和即可。

### T3

我怎么这种 sb 构造都不会。

假设我们比较笨，只能一格一格地满足。用另外两个操作来抵消一个操作影响的一行一列，那么可以想到用四个操作来造成四个格子 $\begin{bmatrix}1&-1\\-1&1\end{bmatrix}$ 的效果。

因为一定有解，并且每行每列的和恒不变，那么可以不管最后一行和最后一列，里面的格子满足了外面一定满足。

令一轮操作影响的四个格子为 $(i,j),(i,n),(n,j),(n,n)$ 即可。里面的挨个做，最后一行和最后一列的操作能抵消的合并一下，操作次数就是 $\mathcal O(n^3)$ 级别的。

### T4

首先要能观察规律，结论是：

若从 $(a,b)$ 走到 $(c,d)$，假设 $a < b,c < d$，那么只有中间的矩形部分每行都存在障碍点 $(i,y_i),i\in [a,c]$，并且 $y_i < y_{i+1}$ 的时候，路径长度会多出两步。

![](https://z3.ax1x.com/2021/10/13/5KjgxK.png)

先算出不考虑障碍点时任意两点的路径长度和，然后加上两倍上面的方案数。
